# Настройка рабочего профиля

TikMatrix поддерживает индивидуальную настройку пользователей рабочего профиля для каждого устройства, что очень полезно для корпоративных устройств или сред с двойными приложениями.

## Что такое рабочий профиль

Рабочий профиль - это функция Android, которая позволяет создать независимую рабочую среду на одном устройстве. Настроив различные идентификаторы пользователей, вы можете:

- Нормально использовать TikMatrix на корпоративных устройствах
- Устанавливать различные пользовательские конфигурации для разных сред приложений
- Достичь более детального управления устройствами и контроля разрешений

## Как настроить рабочий профиль

### 1. Открыть панель инструментов устройства

Когда ваше устройство подключено и отображается в главном интерфейсе TikMatrix:

1. Дважды щелкните карточку устройства для входа в полноэкранный режим
2. Справа от экрана устройства появится панель инструментов
3. Панель инструментов по умолчанию свернута и автоматически разворачивается при наведении

### 2. Найти кнопку рабочего профиля

В нижней части панели инструментов вы увидите кнопку с иконкой портфеля - это кнопка настройки рабочего профиля.

### 3. Установить ID пользователя

1. Нажмите кнопку с иконкой портфеля
2. Введите ID пользователя во всплывающем диалоге (например: 10)
3. Нажмите кнопку "Сохранить"

### 4. Подтвердить настройку

После успешной настройки система отобразит уведомление "Настройки пользователя рабочего профиля сохранены".

## Описание ID пользователя

### Общие ID пользователей

- **0**: Основной пользователь (пользователь по умолчанию)
- **10**: Первый пользователь рабочего профиля
- **11**: Второй пользователь рабочего профиля
- Дополнительные ID пользователей следуют этому шаблону

### Как найти ID пользователя

Если вы не уверены в ID пользователей на вашем устройстве, вы можете найти их используя:

```bash
adb shell pm list users
```

Или выполнить в инструментах отладки TikMatrix:

```bash
pm list users
```

Пример вывода:

```text
Users:
  UserInfo{0:Owner:c13} running
  UserInfo{10:Work profile:1030} running
```

## Хранение конфигурационного файла

Настройки рабочего профиля автоматически сохраняются в файл `data/work_profile_user.json` в следующем формате:

```json
{
  "серийный_номер_устройства_1": "10",
  "серийный_номер_устройства_2": "0",
  "серийный_номер_устройства_3": "11"
}
```

## Управление конфигурациями устройств

### Просмотр текущей конфигурации

Настройка рабочего профиля каждого устройства независима. Вы можете:

1. Устанавливать различные ID пользователей для каждого устройства
2. Изменять существующие пользовательские настройки устройства в любое время
3. Очищать настройки (введите пустое значение и сохраните для удаления настройки)

### Массовое управление

Если вам нужно управлять большим количеством устройств, вы можете напрямую редактировать файл `data/work_profile_user.json`:

1. Закройте приложение TikMatrix
2. Откройте конфигурационный файл
3. Добавьте или измените настройки устройств в формате JSON
4. Перезапустите TikMatrix

## Устранение неполадок

### Общие проблемы

#### В: Команды не выполняются после настройки рабочего профиля

О: Пожалуйста, проверьте:

- Правильный ли ID пользователя
- Существует ли соответствующий пользователь на устройстве
- Достаточно ли у вас разрешений для доступа к этому пользователю

#### В: Как отменить настройку рабочего профиля

О: Очистите поле ввода ID пользователя в диалоге настройки и нажмите сохранить.

#### В: Что делать, если настройки потеряны

О: Настройки хранятся в локальном JSON файле. Если потеряны, можно перенастроить или восстановить файл `data/work_profile_user.json` из резервной копии.

## Лучшие практики

### Корпоративная среда

1. **Единое управление**: Установите одинаковый ID пользователя для всех корпоративных устройств
2. **Разделение разрешений**: Используйте разные ID пользователей для различения уровней разрешений
3. **Резервное копирование настроек**: Регулярно создавайте резервные копии файла `work_profile_user.json`

### Личное использование

1. **Изоляция приложений**: Устанавливайте разные пользовательские среды для разных целей
2. **Тестовая среда**: Используйте независимые ID пользователей для тестирования приложений
3. **Защита конфиденциальности**: Повышайте безопасность конфиденциальности через разделение пользователей

## Технические детали

Функция рабочего профиля реализуется добавлением параметра `--user` к командам ADB:

```bash
# Без рабочего профиля
adb shell input tap 100 200

# С рабочим профилем (ID пользователя: 10)
adb shell --user 10 input tap 100 200
```

Это обеспечивает выполнение команд в правильной пользовательской среде, избегая проблем с разрешениями и конфликтов сред.

---

Правильно настроив рабочий профиль, вы можете гладко использовать TikMatrix в различных сложных средах устройств, повышая эффективность работы и удобство управления.

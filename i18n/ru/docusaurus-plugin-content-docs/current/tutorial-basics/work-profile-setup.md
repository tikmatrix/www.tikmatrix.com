# Настройка рабочего профиля

TikZenX поддерживает индивидуальную настройку пользователей рабочего профиля для каждого устройства, что очень полезно для корпоративных устройств или сред с двойными приложениями.

## Что такое рабочий профиль

Рабочий профиль - это функция Android, которая позволяет создать независимую рабочую среду на одном устройстве. Настроив различные идентификаторы пользователей, вы можете:

- Нормально использовать TikZenX на корпоративных устройствах
- Устанавливать различные пользовательские конфигурации для разных сред приложений
- Достичь более детального управления устройствами и контроля разрешений

## Использование инструмента Shelter для клонирования приложений

Перед настройкой рабочего профиля необходимо использовать инструмент Shelter для клонирования приложений TikTok и TikZenX:

### Что такое Shelter

Shelter - это приложение с открытым исходным кодом, которое создает и управляет рабочим профилем на Android-устройствах. Оно позволяет запускать дублированные приложения в изолированной рабочей среде.

### Установка Shelter

1. Скачайте Shelter из [F-Droid](https://f-droid.org/packages/net.typeblog.shelter/) или [Google Play Маркет](https://play.google.com/store/apps/details?id=net.typeblog.shelter)
2. Установите и откройте Shelter на вашем устройстве
3. Следуйте мастеру настройки для создания рабочего профиля

### Клонирование необходимых приложений

После настройки Shelter необходимо клонировать приложения TikTok и TikZenX:

1. **Клонирование приложения TikTok**:
   - Откройте Shelter и перейдите на вкладку "Основной"
   - Найдите TikTok в списке приложений
   - Нажмите кнопку "Клонировать в рабочий профиль"
   - Дождитесь завершения процесса клонирования

2. **Клонирование приложения TikZenX**:
   - В Shelter найдите TikZenX в списке приложений
   - Нажмите кнопку "Клонировать в рабочий профиль"
   - Подтвердите операцию клонирования

### Проверка успешного клонирования

После успешного клонирования:

- Вы увидите TikTok и TikZenX с иконкой портфеля в панели приложений
- Это версии приложений для рабочего профиля
- Оригинальные приложения остаются неизменными в основном профиле

## Как настроить рабочий профиль

### 1. Открыть панель инструментов устройства

Когда ваше устройство подключено и отображается в главном интерфейсе TikZenX:

1. Дважды щелкните карточку устройства для входа в полноэкранный режим
2. Справа от экрана устройства появится панель инструментов
3. Панель инструментов по умолчанию свернута и автоматически разворачивается при наведении

### 2. Найти кнопку рабочего профиля

В нижней части панели инструментов вы увидите кнопку с иконкой портфеля - это кнопка настройки рабочего профиля.

### 3. Установить ID пользователя

1. Нажмите кнопку с иконкой портфеля
2. Введите ID пользователя во всплывающем диалоге (например: 10)
3. Нажмите кнопку "Сохранить"

### 4. Подтвердить настройку

После успешной настройки система отобразит уведомление "Настройки пользователя рабочего профиля сохранены".

## Описание ID пользователя

### Общие ID пользователей

- **0**: Основной пользователь (пользователь по умолчанию)
- **10**: Первый пользователь рабочего профиля
- **11**: Второй пользователь рабочего профиля
- Дополнительные ID пользователей следуют этому шаблону

### Как найти ID пользователя

Если вы не уверены в ID пользователей на вашем устройстве, вы можете найти их используя:

```bash
adb shell pm list users
```

Или выполнить в инструментах отладки TikZenX:

```bash
pm list users
```

Пример вывода:

```text
Users:
  UserInfo{0:Owner:c13} running
  UserInfo{10:Work profile:1030} running
```

## Хранение конфигурационного файла

Настройки рабочего профиля автоматически сохраняются в файл `data/work_profile_user.json` в следующем формате:

```json
{
  "серийный_номер_устройства_1": "10",
  "серийный_номер_устройства_2": "0",
  "серийный_номер_устройства_3": "11"
}
```

## Управление конфигурациями устройств

### Просмотр текущей конфигурации

Настройка рабочего профиля каждого устройства независима. Вы можете:

1. Устанавливать различные ID пользователей для каждого устройства
2. Изменять существующие пользовательские настройки устройства в любое время
3. Очищать настройки (введите пустое значение и сохраните для удаления настройки)

### Массовое управление

Если вам нужно управлять большим количеством устройств, вы можете напрямую редактировать файл `data/work_profile_user.json`:

1. Закройте приложение TikZenX
2. Откройте конфигурационный файл
3. Добавьте или измените настройки устройств в формате JSON
4. Перезапустите TikZenX

## Устранение неполадок

### Общие проблемы

#### В: Команды не выполняются после настройки рабочего профиля

О: Пожалуйста, проверьте:

- Правильный ли ID пользователя
- Существует ли соответствующий пользователь на устройстве
- Достаточно ли у вас разрешений для доступа к этому пользователю

#### В: Как отменить настройку рабочего профиля

О: Очистите поле ввода ID пользователя в диалоге настройки и нажмите сохранить.

#### В: Что делать, если настройки потеряны

О: Настройки хранятся в локальном JSON файле. Если потеряны, можно перенастроить или восстановить файл `data/work_profile_user.json` из резервной копии.

#### В: Проблемы, связанные с Shelter

О: Если вы столкнулись с проблемами Shelter:

- **Клонирование не удается**: Убедитесь, что у вас есть права администратора и достаточно места в хранилище
- **Клонированные приложения не видны**: Проверьте, правильно ли активирован рабочий профиль в Shelter
- **Приложения аварийно завершаются в рабочем профиле**: Попробуйте повторно клонировать приложения или обновить Shelter
- **Не могу найти клонированные приложения**: Ищите приложения с иконками портфеля в панели приложений

## Лучшие практики

### Корпоративная среда

1. **Единое управление**: Установите одинаковый ID пользователя для всех корпоративных устройств
2. **Разделение разрешений**: Используйте разные ID пользователей для различения уровней разрешений
3. **Резервное копирование настроек**: Регулярно создавайте резервные копии файла `work_profile_user.json`

### Личное использование

1. **Изоляция приложений**: Устанавливайте разные пользовательские среды для разных целей
2. **Тестовая среда**: Используйте независимые ID пользователей для тестирования приложений
3. **Защита конфиденциальности**: Повышайте безопасность конфиденциальности через разделение пользователей

### Управление инструментом Shelter

1. **Регулярные обновления**: Поддерживайте приложение Shelter в актуальном состоянии для обеспечения совместимости
2. **Синхронизация приложений**: Убедитесь, что TikTok и TikZenX клонированы перед настройкой рабочего профиля
3. **Резервное копирование настроек Shelter**: Экспортируйте и создавайте резервные копии конфигураций Shelter для легкого восстановления
4. **Мониторинг обновлений приложений**: При обновлении TikTok или TikZenX может потребоваться обновление клонированных версий

## Технические детали

Функция рабочего профиля реализуется добавлением параметра `--user` к командам ADB:

```bash
# Без рабочего профиля
adb shell input tap 100 200

# С рабочим профилем (ID пользователя: 10)
adb shell --user 10 input tap 100 200
```

Это обеспечивает выполнение команд в правильной пользовательской среде, избегая проблем с разрешениями и конфликтов сред.

---

Правильно настроив рабочий профиль, вы можете гладко использовать TikZenX в различных сложных средах устройств, повышая эффективность работы и удобство управления.
